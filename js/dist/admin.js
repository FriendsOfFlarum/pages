(()=>{var t={n:e=>{var a=e&&e.__esModule?()=>e.default:()=>e;return t.d(a,{a}),a},d:(e,a)=>{for(var n in a)t.o(a,n)&&!t.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:a[n]})},o:(t,e)=>Object.prototype.hasOwnProperty.call(t,e)};(()=>{"use strict";function e(t,a){return e=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},e(t,a)}function a(t,a){t.prototype=Object.create(a.prototype),t.prototype.constructor=t,e(t,a)}const n=flarum.core.compat.app;var s=t.n(n);const o=flarum.core.compat["common/Model"];var i=t.n(o);const r=flarum.core.compat["common/utils/computed"];var l=t.n(r);const c=flarum.core.compat["common/utils/string"],p=flarum.core.compat["common/utils/ItemList"];var d=t.n(p);const u=flarum.core.compat["common/components/Badge"];var g=t.n(u),h=function(t){function e(){for(var e,a=arguments.length,n=new Array(a),s=0;s<a;s++)n[s]=arguments[s];return(e=t.call.apply(t,[this].concat(n))||this).title=i().attribute("title"),e.time=i().attribute("time",i().transformDate),e.editTime=i().attribute("editTime",i().transformDate),e.content=i().attribute("content"),e.contentHtml=i().attribute("contentHtml"),e.contentPlain=l()("contentHtml",c.getPlainContent),e.slug=i().attribute("slug"),e.isHidden=i().attribute("isHidden"),e.isRestricted=i().attribute("isRestricted"),e.isHtml=i().attribute("isHtml"),e}return a(e,t),e.prototype.badges=function(){var t=new(d());return this.isHidden()&&t.add("hidden",g().component({type:"hidden",icon:"fas fa-trash",label:s().translator.trans("fof-pages.admin.badges.hidden")})),this.isRestricted()&&t.add("restricted",g().component({type:"restricted",icon:"fas fa-user-shield",label:s().translator.trans("fof-pages.admin.badges.restricted")})),t},e}(i());const f=flarum.core.compat["admin/components/ExtensionPage"];var v=t.n(f);const b=flarum.core.compat["common/components/Button"];var _=t.n(b);const y=flarum.core.compat["common/components/Modal"];var N=t.n(y);const P=flarum.core.compat["common/utils/Stream"];var R=t.n(P);const k=flarum.core.compat["common/utils/withAttr"];var x=t.n(k);const H=flarum.core.compat["common/utils/setRouteWithForcedRefresh"];var B=t.n(H),w=function(t){function e(){return t.apply(this,arguments)||this}a(e,t);var n=e.prototype;return n.oninit=function(e){t.prototype.oninit.call(this,e),this.page=this.attrs.page||app.store.createRecord("pages"),this.pageTitle=R()(this.page.title()||""),this.slug=R()(this.page.slug()||""),this.pageContent=R()(this.page.content()||""),this.isHidden=R()(this.page.isHidden()),this.isRestricted=R()(this.page.isRestricted()),this.isHtml=R()(this.page.isHtml())},n.className=function(){return"EditPageModal Modal--large"},n.title=function(){return this.pageTitle()||app.translator.trans("fof-pages.admin.edit_page.title")},n.content=function(){var t=this;return m("div",{className:"Modal-body"},m("div",{className:"Form"},m("div",{className:"Form-group"},m("label",null,app.translator.trans("fof-pages.admin.edit_page.title_label")),m("input",{className:"FormControl",placeholder:app.translator.trans("fof-pages.admin.edit_page.title_placeholder"),value:this.pageTitle(),oninput:function(e){t.pageTitle(e.target.value),t.slug((0,c.slug)(e.target.value))}})),m("div",{className:"Form-group"},m("label",null,app.translator.trans("fof-pages.admin.edit_page.slug_label")),m("input",{className:"FormControl",placeholder:app.translator.trans("fof-pages.admin.edit_page.slug_placeholder"),value:this.slug(),oninput:function(e){t.slug(e.target.value)}})),m("div",{className:"Form-group"},m("label",null,app.translator.trans("fof-pages.admin.edit_page.content_label")),m("textarea",{className:"FormControl",rows:"5",value:this.pageContent(),onchange:x()("value",this.pageContent),placeholder:app.translator.trans("fof-pages.admin.edit_page.content_placeholder")})),m("div",{className:"Form-group"},m("div",null,m("label",{className:"checkbox"},m("input",{type:"checkbox",checked:this.isHidden(),onchange:x()("checked",this.isHidden)}),app.translator.trans("fof-pages.admin.edit_page.hidden_label")))),m("div",{className:"Form-group"},m("div",null,m("label",{className:"checkbox"},m("input",{type:"checkbox",checked:this.isRestricted(),onchange:x()("checked",this.isRestricted)}),app.translator.trans("fof-pages.admin.edit_page.restricted_label")))),m("div",{className:"Form-group"},m("div",null,m("label",{className:"checkbox"},m("input",{type:"checkbox",checked:this.isHtml(),onchange:x()("checked",this.isHtml)}),app.translator.trans("fof-pages.admin.edit_page.html_label")))),m("div",{className:"Form-group"},_().component({type:"submit",className:"Button Button--primary EditPageModal-save",loading:this.loading},app.translator.trans("fof-pages.admin.edit_page.submit_button")),this.page.exists?m("button",{type:"button",className:"Button EditPageModal-delete",onclick:this.delete.bind(this)},app.translator.trans("fof-pages.admin.edit_page.delete_page_button")):"")))},n.onsubmit=function(t){var e=this;t.preventDefault(),this.loading=!0,this.page.save({title:this.pageTitle(),slug:this.slug(),content:this.pageContent(),isHidden:this.isHidden(),isRestricted:this.isRestricted(),isHtml:this.isHtml()},{errorHandler:this.onerror.bind(this)}).then(this.hideAndRefresh.bind(this)).catch((function(){e.loading=!1,m.redraw()}))},n.hideAndRefresh=function(){this.hide(),B()(app.route("extension",{id:"fof-pages"}))},n.delete=function(){var t=this;this.loading=!0,confirm(app.translator.trans("fof-pages.admin.edit_page.delete_page_confirmation"))&&this.page.delete().then(this.hideAndRefresh.bind(this)).catch((function(){t.loading=!1,m.redraw()}))},e}(N());const F=flarum.core.compat["common/Component"];var L=t.n(F);const A=flarum.core.compat["common/components/LoadingIndicator"];var C=t.n(A);const O=flarum.core.compat["common/components/Placeholder"];var M=t.n(O);const T=flarum.core.compat["admin/utils/saveSettings"];var j=t.n(T);const D=flarum.core.compat["common/helpers/listItems"];var E=t.n(D),I=function(t){function e(){return t.apply(this,arguments)||this}a(e,t);var n=e.prototype;return n.view=function(){var t=this.attrs.page,e=app.forum.attribute("baseUrl")+"/p/"+t.id()+"-"+t.slug(),a=t.badges().toArray();return m("tr",{key:t.id()},m("th",null,t.title(),a.length?m("ul",{className:"badges"},E()(t.badges().toArray())):null),m("td",{className:"Pages-actions"},m("div",{className:"ButtonGroup"},_().component({className:"Button Button--page-edit",icon:"fas fa-pencil-alt",onclick:function(){return app.modal.show(w,{page:t})}}),_().component({className:"Button Button--page-edit",icon:"fas fa-home",onclick:this.setAsHomePage.bind(this),disabled:app.data.settings.pages_home===t.id()&&"/pages/home"===app.data.settings.default_route}),_().component({className:"Button Button--page-view",icon:"fas fa-eye fa-sm",onclick:function(){return window.open(e,"_blank")}}),_().component({className:"Button Button--danger Button--page-delete",icon:"fas fa-times",onclick:this.delete.bind(this)}))))},n.setAsHomePage=function(){var t=this;if(app.alerts.dismiss(this.successAlert),confirm(app.translator.trans("fof-pages.admin.edit_page.set_as_home_page_confirmation"))){var e=this.attrs.page;j()({default_route:"/pages/home",pages_home:e.id()}).then((function(){app.alerts.show({type:"success"},app.translator.trans("fof-pages.admin.edit_page.set_as_home_page_done"))})).catch((function(){})).then((function(){t.loading=!1,m.redraw()}))}},n.delete=function(){confirm(app.translator.trans("fof-pages.admin.edit_page.delete_page_confirmation"))&&this.attrs.page.delete().then((function(){B()(app.route("extension",{id:"fof-pages"}))}))},e}(L()),S=function(t){function e(){return t.apply(this,arguments)||this}a(e,t);var n=e.prototype;return n.oninit=function(e){t.prototype.oninit.call(this,e),this.loading=!0,this.pages=[],this.page=0,this.loadLimit=20,this.refresh()},n.view=function(){if(this.loading)return m("div",{className:"PageList-loading"},C().component());if(0===this.pages.length){var t=app.translator.trans("fof-pages.admin.pages_list.empty_text");return M().component({text:t})}var e,a;return!0===this.nextResults&&(e=_().component({className:"Button Button--PageList-next",icon:"fas fa-angle-right",onclick:this.loadNext.bind(this)})),!0===this.prevResults&&(a=_().component({className:"Button Button--PageList-prev",icon:"fas fa-angle-left",onclick:this.loadPrev.bind(this)})),m("div",{className:"PageList"},m("table",{className:"PageList-results"},m("thead",null,m("tr",null,m("th",null,app.translator.trans("fof-pages.admin.pages_list.title")),m("th",null))),m("tbody",null,this.pages.map((function(t){return I.component({page:t})})))),m("div",{className:"PageList-pagination"},e,a))},n.refresh=function(t){return void 0===t&&(t=!0),t&&(this.loading=!0,this.pages=[]),this.loadResults().then(this.parseResults.bind(this))},n.loadResults=function(){var t=this.page*this.loadLimit;return app.store.find("pages",{page:{offset:t,limit:this.loadLimit},sort:"-time"})},n.loadNext=function(){!0===this.nextResults&&(this.page++,this.refresh())},n.loadPrev=function(){!0===this.prevResults&&(this.page--,this.refresh())},n.parseResults=function(t){return[].push.apply(this.pages,t),this.loading=!1,this.nextResults=!!t.payload.links.next,this.prevResults=!!t.payload.links.prev,m.redraw(),t},e}(L()),z=function(t){function e(){return t.apply(this,arguments)||this}return a(e,t),e.prototype.content=function(){return m("div",{className:"PagesPage"},m("div",{className:"PagesPage-header"},m("div",{className:"container"},_().component({className:"Button Button--primary",icon:"fas fa-plus",onclick:function(){return app.modal.show(w)}},app.translator.trans("fof-pages.admin.pages.create_button")))),m("div",{className:"PagesPage-list"},m("div",{className:"container"},S.component())))},e}(v());const G=flarum.core.compat["common/extend"],U=flarum.core.compat["admin/components/BasicsPage"];var W=t.n(U);app.initializers.add("fof-pages",(function(t){t.store.models.pages=h,t.extensionData.for("fof-pages").registerPage(z).registerPermission({icon:"fas fa-file-alt",label:t.translator.trans("fof-pages.admin.permissions.restricted"),permission:"fof-pages.viewRestricted"},"view"),(0,G.extend)(W().prototype,"homePageItems",(function(t){t.add("fof-pages",{path:"/pages/home",label:"FriendsOfFlarum Pages"})}))}))})(),module.exports={}})();
//# sourceMappingURL=admin.js.map